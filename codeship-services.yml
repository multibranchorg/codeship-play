maven:
  build:
    image: cloudbees/sample-project
    dockerfile: Dockerfile.build
  cached: true
  encrypted_env_file: env.encrypted
  volumes:
  - ./tmp:/target

gitlinks:
 build: 
  image: mic/gitlinks
  dockerfile: Dockerfile.gitlinks
 volumes-from: 
  - maven

integration:
  image: busybox
  depends_on:
    - redis
    - postgres
  environment:
    - DATABASE_URL=postgres://postgres@postgres/YOUR_DATABASE_NAME
    - REDIS_URL=redis://redis
  volumes-from:
    - maven

redis:
  image: healthcheck/redis:alpine
postgres:
  image: healthcheck/postgres:alpine
